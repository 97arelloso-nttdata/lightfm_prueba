<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>An implicit feedback recommender for the Movielens dataset &mdash; LightFM 1.16 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using different learning schedules" href="learning_schedules.html" />
    <link rel="prev" title="Examples" href="../examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> LightFM
          </a>
              <div class="version">
                1.16
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../home.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lightfm.html">The LightFM model class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lightfm.evaluation.html">Model evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cross_validation.html">Cross validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lightfm.data.html">Constructing datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Built-in datasets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Movielens implicit feedback recommender</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implicit-feedback">Implicit feedback</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-the-data">Getting the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitting-models">Fitting models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="learning_schedules.html">Learning rate schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="hybrid_crossvalidated.html">Cold-start hybrid recommender</a></li>
<li class="toctree-l2"><a class="reference internal" href="warp_loss.html">Learning-to-rank using WARP loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataset.html">Building datasets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LightFM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../examples.html">Examples</a> &raquo;</li>
      <li>An implicit feedback recommender for the Movielens dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/movielens_implicit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="an-implicit-feedback-recommender-for-the-movielens-dataset">
<h1>An implicit feedback recommender for the Movielens dataset<a class="headerlink" href="#an-implicit-feedback-recommender-for-the-movielens-dataset" title="Permalink to this headline"></a></h1>
<section id="implicit-feedback">
<h2>Implicit feedback<a class="headerlink" href="#implicit-feedback" title="Permalink to this headline"></a></h2>
<p>For some time, the recommender system literature focused on explicit
feedback: the Netflix prize focused on accurately reproducing the
ratings users have given to movies they watched.</p>
<p>Focusing on ratings in this way ignored the importance of taking into
account which movies the users chose to watch in the first place, and
treating the absence of ratings as absence of information.</p>
<p>But the things that we don’t have ratings for aren’t unknowns: we know
the user didn’t pick them. This reflects a user’s conscious choice, and
is a good source of information on what she thinks she might like.</p>
<p>This sort of phenomenon is described as data which is
missing-not-at-random in the literature: the ratings that are missing
are more likely to be negative precisely because the user chooses which
items to rate. When choosing a restaurant, you only go to places which
you think you’ll enjoy, and never go to places that you think you’ll
hate. What this leads to is that you’re only going to be submitting
ratings for things which, a priori, you expected to like; the things
that you expect you will not like you will never rate.</p>
<p>This observation has led to the development of models that are suitable
for implicit feedback. LightFM implements two that have proven
particular successful:</p>
<ul class="simple">
<li><p>BPR: Bayesian Personalised Ranking [1] pairwise loss. Maximises the
prediction difference between a positive example and a randomly
chosen negative example. Useful when only positive interactions are
present and optimising ROC AUC is desired.</p></li>
<li><p>WARP: Weighted Approximate-Rank Pairwise [2] loss. Maximises the rank
of positive examples by repeatedly sampling negative examples until
rank violating one is found. Useful when only positive interactions
are present and optimising the top of the recommendation list
(precision&#64;k) is desired.</p></li>
</ul>
<p>This example shows how to estimate these models on the Movielens
dataset.</p>
<p>[1] Rendle, Steffen, et al. “BPR: Bayesian personalized ranking from
implicit feedback.” Proceedings of the Twenty-Fifth Conference on
Uncertainty in Artificial Intelligence. AUAI Press, 2009.</p>
<p>[2] Weston, Jason, Samy Bengio, and Nicolas Usunier. “Wsabie: Scaling up
to large vocabulary image annotation.” IJCAI. Vol. 11. 2011.</p>
</section>
<section id="getting-the-data">
<h2>Getting the data<a class="headerlink" href="#getting-the-data" title="Permalink to this headline"></a></h2>
<p>The first step is to get the <a class="reference external" href="http://grouplens.org/datasets/movielens/100k/">Movielens
data</a>. This is a
classic small recommender dataset, consisting of around 950 users, 1700
movies, and 100,000 ratings. The ratings are on a scale from 1 to 5, but
we’ll all treat them as implicit positive feedback in this example.</p>
<p>Fortunately, this is one of the functions provided by LightFM itself.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">lightfm.datasets</span> <span class="kn">import</span> <span class="n">fetch_movielens</span>

<span class="n">movielens</span> <span class="o">=</span> <span class="n">fetch_movielens</span><span class="p">()</span>
</pre></div>
</div>
<p>This gives us a dictionary with the following fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">movielens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(&#39;test&#39;, &lt;class &#39;scipy.sparse.coo.coo_matrix&#39;&gt;, (943, 1682))
(&#39;item_features&#39;, &lt;class &#39;scipy.sparse.csr.csr_matrix&#39;&gt;, (1682, 1682))
(&#39;train&#39;, &lt;class &#39;scipy.sparse.coo.coo_matrix&#39;&gt;, (943, 1682))
(&#39;item_labels&#39;, &lt;type &#39;numpy.ndarray&#39;&gt;, (1682,))
(&#39;item_feature_labels&#39;, &lt;type &#39;numpy.ndarray&#39;&gt;, (1682,))
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">movielens</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">movielens</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">train</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> elements are the most important: they contain
the raw rating data, split into a train and a test set. Each row
represents a user, and each column an item. Entries are ratings from 1
to 5.</p>
</section>
<section id="fitting-models">
<h2>Fitting models<a class="headerlink" href="#fitting-models" title="Permalink to this headline"></a></h2>
<p>Now let’s train a BPR model and look at its accuracy.</p>
<p>We’ll use two metrics of accuracy: precision&#64;k and ROC AUC. Both are
ranking metrics: to compute them, we’ll be constructing recommendation
lists for all of our users, and checking the ranking of known positive
movies. For precision at k we’ll be looking at whether they are within
the first k results on the list; for AUC, we’ll be calculating the
probability that any known positive is higher on the list than a random
negative example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightfm</span> <span class="kn">import</span> <span class="n">LightFM</span>
<span class="kn">from</span> <span class="nn">lightfm.evaluation</span> <span class="kn">import</span> <span class="n">precision_at_k</span>
<span class="kn">from</span> <span class="nn">lightfm.evaluation</span> <span class="kn">import</span> <span class="n">auc_score</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LightFM</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;bpr&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">train_precision</span> <span class="o">=</span> <span class="n">precision_at_k</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">test_precision</span> <span class="o">=</span> <span class="n">precision_at_k</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">train_auc</span> <span class="o">=</span> <span class="n">auc_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">test_auc</span> <span class="o">=</span> <span class="n">auc_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision: train </span><span class="si">%.2f</span><span class="s1">, test </span><span class="si">%.2f</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">train_precision</span><span class="p">,</span> <span class="n">test_precision</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC: train </span><span class="si">%.2f</span><span class="s1">, test </span><span class="si">%.2f</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">train_auc</span><span class="p">,</span> <span class="n">test_auc</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Precision</span><span class="p">:</span> <span class="n">train</span> <span class="mf">0.59</span><span class="p">,</span> <span class="n">test</span> <span class="mf">0.10</span><span class="o">.</span>
<span class="n">AUC</span><span class="p">:</span> <span class="n">train</span> <span class="mf">0.90</span><span class="p">,</span> <span class="n">test</span> <span class="mf">0.86</span><span class="o">.</span>
</pre></div>
</div>
<p>The WARP model, on the other hand, optimises for <a class="reference external" href="mailto:precision&#37;&#52;&#48;k---we">precision<span>&#64;</span>k—we</a> should
expect its performance to be better on precision.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LightFM</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;warp&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit_partial</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">train_precision</span> <span class="o">=</span> <span class="n">precision_at_k</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">test_precision</span> <span class="o">=</span> <span class="n">precision_at_k</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">train_auc</span> <span class="o">=</span> <span class="n">auc_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">test_auc</span> <span class="o">=</span> <span class="n">auc_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision: train </span><span class="si">%.2f</span><span class="s1">, test </span><span class="si">%.2f</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">train_precision</span><span class="p">,</span> <span class="n">test_precision</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC: train </span><span class="si">%.2f</span><span class="s1">, test </span><span class="si">%.2f</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">train_auc</span><span class="p">,</span> <span class="n">test_auc</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Precision</span><span class="p">:</span> <span class="n">train</span> <span class="mf">0.61</span><span class="p">,</span> <span class="n">test</span> <span class="mf">0.11</span><span class="o">.</span>
<span class="n">AUC</span><span class="p">:</span> <span class="n">train</span> <span class="mf">0.93</span><span class="p">,</span> <span class="n">test</span> <span class="mf">0.90</span><span class="o">.</span>
</pre></div>
</div>
<p>And that is exactly what we see: we get slightly higher <a class="reference external" href="mailto:precision&#37;&#52;&#48;10">precision<span>&#64;</span>10</a>
(but the AUC metric is also improved).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="learning_schedules.html" class="btn btn-neutral float-right" title="Using different learning schedules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Lyst (Maciej Kula).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>